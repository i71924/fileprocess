<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>圖片轉 Word</title>
</head>
<body>
  <h2>請上傳圖片</h2>
  <input type="file" id="imageInput" accept="image/*" multiple />
  <br><br>
  <button onclick="generateWord()">產生 Word 檔</button>
  <button id="downloadBtn" onclick="downloadWord()" disabled>下載 Word 檔</button>

  <div id="imagePreview" style="display:none;"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.4.0/html-docx.min.js"></script>
  <script>
    const imagePreview = document.getElementById('imagePreview');
    const imageInput = document.getElementById('imageInput');
    const downloadBtn = document.getElementById('downloadBtn');

    let wordBlob = null; // 用來儲存產生後的 Word Blob

    function generateWord() {
      imagePreview.innerHTML = '';
      wordBlob = null;
      downloadBtn.disabled = true;

      const files = imageInput.files;
      if (files.length === 0) {
        alert('請選擇至少一張圖片');
        return;
      }

      imagePreview.style.display = 'block';
      const readerPromises = [];

      for (let i = 0; i < files.length; i++) {
        const file = files[i];

        const reader = new FileReader();
        readerPromises.push(
          new Promise((resolve) => {
            reader.onload = function (e) {
              const img = document.createElement('img');
              img.src = e.target.result;
              img.style.maxWidth = '600px';
              img.style.display = 'block';
              img.style.marginBottom = '40px';
              img.style.pageBreakAfter = 'always'; // 每張圖片換頁
              imagePreview.appendChild(img);
              resolve();
            };
            reader.readAsDataURL(file);
          })
        );
      }

      Promise.all(readerPromises).then(() => {
        const htmlContent = '<html><body>' + imagePreview.innerHTML + '</body></html>';
        wordBlob = htmlDocx.asBlob(htmlContent);
        downloadBtn.disabled = false; // 啟用下載按鈕
        alert('Word 檔案已建立，請點擊下載');
      });
    }

    function downloadWord() {
      if (!wordBlob) {
        alert('請先產生 Word 檔案');
        return;
      }
      const a = document.createElement('a');
      a.href = URL.createObjectURL(wordBlob);
      a.download = 'images.docx';
      a.click();
    }
  </script>
</body>
</html>
